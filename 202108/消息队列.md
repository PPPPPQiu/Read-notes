# 消息队列  

消息队列，是一个存放消息的容器，需要使用消息时，直接从容器中取出。  
消息队列是分布式系统中重要组件之一，主要是为了通过异步处理提高系统性能和削峰、降低系统耦合性  
先进先出，按照顺序  


### 好处  
1. 通过异步处理提高系统性能，减少相应所需时间  
2. 削峰/限流  
> 先将短时间高并发产生的事务消息存储在消息队列中，然后后端服务再慢慢根据自己的能力去消费这些消息，这样就避免直接把后端服务打垮掉。  

3. 降低系统耦合性  
> 消息发送者（生产者）和消息接受者（消费者）之间没有直接耦合  

### 问题  
1. 系统可用性降低  
2. 系统复杂性提高  
3. 一致性问题  

## JMS  
Java消息服务，Java API，JMS 的客户端之间可以通过 JMS 服务进行异步的消息传输。  
它使分布式通信耦合度更低，消息服务更加可靠以及异步性。  

### JMS两种消息模型  
1. 点到点（P2P）模型  
使用队列（Queue）作为消息通信载体；  

2. 发布/订阅（Pub/Sub）模型  
使用主题（Topic）作为消息通信载体，类似于广播模式；  

## AMQP  
一个提供统一消息服务的应用层标准 高级消息队列协议（二进制应用层协议）  

总结：

- AMQP 为消息定义了线路层（wire-level protocol）的协议，而 JMS 所定义的是 API 规范。在 Java 体系中，多个 client 均可以通过 JMS 进行交互，不需要应用修改代码，但是其对跨平台的支持较差。而 AMQP 天然具有跨平台、跨语言特性。  
- JMS 支持 TextMessage、MapMessage 等复杂的消息类型；而 AMQP 仅支持 byte[] 消息类型（复杂的类型可序列化后发送）。  
- 由于 Exchange 提供的路由算法，AMQP 可以提供多样化的路由方式来传递消息到消息队列，而 JMS 仅支持 队列 和 主题/订阅 方式两种。  


## 常见的消息队列  
### ActiveMQ  
比较成熟，但是较目前来说，ActiveMQ 的性能比较差，而且版本迭代很慢，不推荐使用。  
### RabbitMQ  
在吞吐量方面虽然稍逊于 Kafka 和 RocketMQ ，但是由于它基于 erlang 开发，所以并发能力很强，性能极其好，延时很低，达到微秒级。  
但是也因为 RabbitMQ 基于 erlang 开发，所以国内很少有公司有实力做 erlang 源码级别的研究和定制。  
如果业务场景对并发量要求不是太高（十万级、百万级），那这四种消息队列中，RabbitMQ 一定是你的首选。  
如果是大数据领域的实时计算、日志采集等场景，用 Kafka 是业内标准的，绝对没问题，社区活跃度很高，绝对不会黄，何况几乎是全世界这个领域的事实性规范。  
### RocketMQ  
RocketMQ 阿里出品，Java 系开源项目，源代码我们可以直接阅读，然后可以定制自己公司的 MQ，并且 RocketMQ 有阿里巴巴的实际业务场景的实战考验。  
RocketMQ 社区活跃度相对较为一般，不过也还可以，文档相对来说简单一些，然后接口这块不是按照标准 JMS 规范走的有些系统要迁移需要修改大量代码。  
还有就是阿里出台的技术，你得做好这个技术万一被抛弃，社区黄掉的风险，那如果你们公司有技术实力我觉得用 RocketMQ 挺好的  

### Kafka  
仅仅提供较少的核心功能，但是提供超高的吞吐量，ms 级的延迟，极高的可用性以及可靠性，而且分布式可以任意扩展。  
同时 kafka 最好是支撑较少的 topic 数量即可，保证其超高吞吐量。  
kafka 唯一的一点劣势是有可能消息重复消费，那么对数据准确性会造成极其轻微的影响，在大数据领域中以及日志采集中，这点轻微影响可以忽略这个特性天然适合大数据实时计算以及日志收集。  



























